<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Radio Bonne Nouvelle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5c3a;
            --secondary: #84ce59;
            --accent: #FFD700;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f6fa;
            color: #333;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--primary), #134028);
            color: white;
            overflow-y: auto;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-logo span {
            color: var(--secondary);
        }

        .sidebar-nav {
            padding: 1.5rem 0;
        }

        .nav-item {
            margin: 0.3rem 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary);
        }

        .nav-link i {
            font-size: 1.2rem;
            width: 25px;
        }

        /* MAIN CONTENT */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* TOPBAR */
        .topbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar-left h1 {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }

        /* CONTENT */
        .content {
            padding: 2rem;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-info h3 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .stat-icon.success { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .stat-icon.warning { background: linear-gradient(135deg, #f39c12, #f1c40f); color: white; }
        .stat-icon.danger { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }

        /* SECTIONS */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .card-header h2 {
            color: var(--dark);
            font-size: 1.5rem;
        }

        /* FORMS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(132, 206, 89, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* BUTTONS */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #6ab847;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(132, 206, 89, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #d5d8dc;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* TABLE */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead {
            background: var(--primary);
            color: white;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
        }

        .table tbody tr {
            border-bottom: 1px solid var(--light);
            transition: background 0.3s;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-primary { background: #d1ecf1; color: #0c5460; }
        .badge-info { background: #d1ecf1; color: #0c5460; }

        /* LIVE STREAM */
        .stream-preview {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            padding-bottom: 56.25%;
            margin-bottom: 1rem;
        }

        .stream-preview iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .stream-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .stream-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* FILE UPLOAD */
        .file-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: var(--secondary);
            background: rgba(132, 206, 89, 0.05);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload i {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        /* MOBILE TOGGLE */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 10px;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 1.3rem;
            color: var(--primary);
        }

        /* RESPONSIVE */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: flex;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

/* STYLES UPLOAD AUDIO */
.file-upload-area {
    border: 2px dashed #e0e0e0;
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    background: #fafafa;
}

.file-upload-area:hover {
    border-color: var(--secondary);
    background: rgba(132, 206, 89, 0.05);
}

.upload-placeholder i {
    font-size: 3rem;
    color: var(--secondary);
    margin-bottom: 1rem;
}

.upload-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 10px;
    border: 2px solid var(--secondary);
}

.upload-preview i {
    color: var(--secondary);
    font-size: 1.5rem;
}

.upload-preview button {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 0.5rem;
}

.upload-preview button:hover {
    color: var(--danger);
}

/* BOUTON CHARGEMENT */
.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.fa-spin {
    animation: fa-spin 1s infinite linear;
}

@keyframes fa-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

    </style>
</head>
<body>
    <!-- MOBILE TOGGLE -->
    <div class="mobile-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-broadcast-tower"></i>
                Radio <span>Bonne Nouvelle</span>
            </div>
            <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">Tableau de Bord Admin</p>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-item">
                <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Tableau de Bord</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('live')">
                    <i class="fas fa-satellite-dish"></i>
                    <span>Gérer le Direct</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('programs')">
                    <i class="fas fa-microphone"></i>
                    <span>Émissions</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('recordings')">
                    <i class="fas fa-file-audio"></i>
                    <span>Enregistrements</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('donations')">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span>Dons Reçus</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('projects')">
                    <i class="fas fa-tasks"></i>
                    <span>Projets</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('testimonials')">
                    <i class="fas fa-comment-dots"></i>
                    <span>Témoignages</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Paramètres</span>
                </a>
            </div>
            <div class="nav-item" style="margin-top: 2rem;">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-arrow-left"></i>
                    <span>Retour au Site</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- TOPBAR -->
        <div class="topbar">
            <div class="topbar-left">
                <h1 id="pageTitle">Tableau de Bord</h1>
            </div>
            <div class="topbar-right">
                <div class="user-profile">
                    <div class="user-avatar">AD</div>
                    <div>
                        <strong>Administrateur</strong>
                        <p style="font-size: 0.85rem; color: #666;">Admin Principal</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- DASHBOARD SECTION -->
            <section class="section active" id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>50,245</h3>
                            <p>Auditeurs ce Mois</p>
                        </div>
                        <div class="stat-icon primary">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>127</h3>
                            <p>Émissions Diffusées</p>
                        </div>
                        <div class="stat-icon success">
                            <i class="fas fa-microphone-alt"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>45</h3>
                            <p>Dons ce Mois</p>
                        </div>
                        <div class="stat-icon warning">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>8.5M FCFA</h3>
                            <p>Total Collecté</p>
                        </div>
                        <div class="stat-icon danger">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-calendar-alt"></i> Émissions à Venir</h2>
                        <button class="btn btn-primary" onclick="showSection('programs')">
                            <i class="fas fa-plus"></i> Nouvelle Émission
                        </button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Émission</th>
                                <th>Date & Heure</th>
                                <th>Animateur</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Étude Biblique</strong></td>
                                <td>Lundi 25 Nov - 18:00</td>
                                <td>Pasteur Jean</td>
                                <td><span class="badge badge-success">Planifiée</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Louange & Adoration</strong></td>
                                <td>Vendredi 29 Nov - 19:00</td>
                                <td>Équipe de Louange</td>
                                <td><span class="badge badge-success">Planifiée</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Culte Dominical</strong></td>
                                <td>Dimanche 1 Déc - 10:00</td>
                                <td>Pasteur Principal</td>
                                <td><span class="badge badge-warning">En Préparation</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- LIVE STREAM SECTION -->
            <section class="section" id="live">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-satellite-dish"></i> Gérer le Direct Facebook</h2>
                    </div>
                    
                    <div class="form-group">
                        <label>Lien de la Vidéo Facebook Live</label>
                        <input type="url" id="liveUrl" placeholder="https://www.facebook.com/watch/live/?v=..." style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="updateLiveStream()">
                            <i class="fas fa-upload"></i> Mettre à Jour le Direct
                        </button>
                        <button class="btn btn-danger" onclick="stopLiveStream()">
                            <i class="fas fa-stop"></i> Arrêter le Direct
                        </button>
                    </div>

                    <div class="stream-preview" id="livePreview">
                        <div class="stream-placeholder">
                            <i class="fas fa-broadcast-tower"></i>
                            <h3>Aucun direct en cours</h3>
                            <p>Ajoutez un lien Facebook Live ci-dessus</p>
                        </div>
                    </div>

                    <div style="background: var(--light); padding: 1.5rem; border-radius: 15px; margin-top: 1rem;">
                        <h4><i class="fas fa-info-circle"></i> Instructions</h4>
                        <ol style="margin-top: 1rem; line-height: 2;">
                            <li>Démarrez votre Facebook Live depuis votre page Facebook</li>
                            <li>Copiez l'URL complète de la vidéo live</li>
                            <li>Collez-la dans le champ ci-dessus</li>
                            <li>Cliquez sur "Mettre à Jour le Direct"</li>
                            <li>Le direct s'affichera automatiquement sur le site</li>
                        </ol>
                    </div>
                </div>
            </section>

            <!-- PROGRAMS SECTION -->
            <section class="section" id="programs">
               <!-- Formulaire amélioré pour émissions -->
<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-microphone"></i> Ajouter une Émission</h2>
    </div>
    <form id="programForm" enctype="multipart/form-data">
        <div class="form-grid">
            <div class="form-group">
                <label>Titre de l'Émission *</label>
                <input type="text" id="programTitle" required placeholder="Ex: Étude Biblique">
            </div>
            <div class="form-group">
                <label>Animateur *</label>
                <input type="text" id="programSpeaker" required placeholder="Nom de l'animateur">
            </div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Durée *</label>
                <input type="text" id="programDuration" required placeholder="Ex: 45:30">
            </div>
            <div class="form-group">
                <label>Catégorie *</label>
                <select id="programCategory" required>
                    <option value="">Sélectionnez...</option>
                    <option value="enseignement">Enseignement</option>
                    <option value="louange">Louange</option>
                    <option value="temoignage">Témoignage</option>
                    <option value="priere">Prière</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Description *</label>
            <textarea id="programDescription" required placeholder="Description de l'émission..." rows="3"></textarea>
        </div>

        <div class="form-group">
            <label>Image (URL Cloudinary)</label>
            <input type="url" id="programImageUrl" placeholder="https://res.cloudinary.com/.../image.jpg">
        </div>

        <!-- UPLOAD AUDIO DIRECT -->
        <div class="form-group">
            <label>Fichier Audio *</label>
            <div class="file-upload-area" id="audioUploadArea">
                <input type="file" id="programAudioFile" accept="audio/*" required style="display: none;">
                <div class="upload-placeholder">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p><strong>Cliquez pour sélectionner un fichier audio</strong></p>
                    <small>MP3, WAV, M4A acceptés (Max 25MB)</small>
                </div>
                <div class="upload-preview" id="audioPreview" style="display: none;">
                    <i class="fas fa-music"></i>
                    <span id="fileName">fichier.mp3</span>
                    <button type="button" onclick="clearAudioFile()"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary" id="submitBtn">
            <i class="fas fa-upload"></i> Publier l'Émission
        </button>
    </form>
</div>
            </section>

            <!-- RECORDINGS SECTION -->
            <section class="section" id="recordings">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-file-audio"></i> Télécharger un Enregistrement</h2>
                    </div>
                    
                    <form onsubmit="uploadRecording(event)">
                        <div class="form-group">
                            <label>Titre de l'Enregistrement</label>
                            <input type="text" placeholder="Ex: Culte du 24 Novembre 2024" required>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Catégorie</label>
                                <select required>
                                    <option value="">Sélectionnez...</option>
                                    <option>Étude Biblique</option>
                                    <option>Louange & Adoration</option>
                                    <option>Témoignages</option>
                                    <option>Culte Dominical</option>
                                    <option>Prière</option>
                                    <option>Autre</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Date de l'Enregistrement</label>
                                <input type="date" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Fichier Audio/Vidéo</label>
                            <div class="file-upload" onclick="document.getElementById('recordingFile').click()">
                                <input type="file" id="recordingFile" accept="audio/*,video/*" required>
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><strong>Cliquez pour télécharger</strong> ou glissez-déposez</p>
                                <small>MP3, MP4, WAV acceptés (Max 500MB)</small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Télécharger l'Enregistrement
                        </button>
                    </form>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h2><i class="fas fa-list"></i> Enregistrements Disponibles</h2>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Catégorie</th>
                                <th>Date</th>
                                <th>Taille</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Culte du 17 Novembre</strong></td>
                                <td><span class="badge badge-primary">Culte</span></td>
                                <td>17/11/2024</td>
                                <td>125 MB</td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-play"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Étude sur la Foi</strong></td>
                                <td><span class="badge badge-success">Étude</span></td>
                                <td>15/11/2024</td>
                                <td>87 MB</td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-play"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- DONATIONS SECTION -->
            <section class="section" id="donations">
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>8.5M FCFA</h3>
                            <p>Total ce Mois</p>
                        </div>
                        <div class="stat-icon success">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>45</h3>
                            <p>Nombre de Donateurs</p>
                        </div>
                        <div class="stat-icon primary">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>2.1M FCFA</h3>
                            <p>Dons cette Semaine</p>
                        </div>
                        <div class="stat-icon warning">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>12</h3>
                            <p>Dons en Attente</p>
                        </div>
                        <div class="stat-icon danger">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-list"></i> Derniers Dons Reçus</h2>
                        <button class="btn btn-primary">
                            <i class="fas fa-download"></i> Exporter
                        </button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Donateur</th>
                                <th>Montant</th>
                                <th>Date</th>
                                <th>Méthode</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Pierre Mbarga</strong></td>
                                <td>50,000 FCFA</td>
                                <td>24/11/2024</td>
                                <td>Mobile Money</td>
                                <td><span class="badge badge-success">Confirmé</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Marie Ngo</strong></td>
                                <td>25,000 FCFA</td>
                                <td>23/11/2024</td>
                                <td>Virement</td>
                                <td><span class="badge badge-success">Confirmé</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Jean Fotso</strong></td>
                                <td>100,000 FCFA</td>
                                <td>22/11/2024</td>
                                <td>Espèces</td>
                                <td><span class="badge badge-warning">En Attente</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Association des Femmes</strong></td>
                                <td>500,000 FCFA</td>
                                <td>20/11/2024</td>
                                <td>Virement</td>
                                <td><span class="badge badge-success">Confirmé</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-bar"></i> Statistiques des Dons</h2>
                    </div>
                    <div style="padding: 1rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4>Dons par Méthode de Paiement</h4>
                                <div style="margin-top: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span>Mobile Money</span>
                                        <span>4.2M FCFA (49%)</span>
                                    </div>
                                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: 49%; background: var(--success);"></div>
                                    </div>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span>Virement Bancaire</span>
                                        <span>3.1M FCFA (36%)</span>
                                    </div>
                                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: 36%; background: var(--primary);"></div>
                                    </div>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span>Espèces</span>
                                        <span>1.2M FCFA (15%)</span>
                                    </div>
                                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: 15%; background: var(--warning);"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4>Évolution Mensuelle</h4>
                                <div style="margin-top: 1rem;">
                                    <div style="display: flex; align-items: end; height: 150px; gap: 1rem;">
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: var(--primary); width: 30px; height: 40%; border-radius: 5px;"></div>
                                            <small>Sept</small>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: var(--primary); width: 30px; height: 60%; border-radius: 5px;"></div>
                                            <small>Oct</small>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: var(--secondary); width: 30px; height: 100%; border-radius: 5px;"></div>
                                            <small>Nov</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PROJECTS SECTION -->
            <section class="section" id="projects">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-plus"></i> Ajouter un Nouveau Projet</h2>
                    </div>
                    
                    <form onsubmit="addProject(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nom du Projet</label>
                                <input type="text" placeholder="Ex: Nouveau Studio" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Objectif de Financement (FCFA)</label>
                                <input type="number" placeholder="Ex: 20000000" required>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Date de Début</label>
                                <input type="date" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Date de Fin Estimée</label>
                                <input type="date" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Description du Projet</label>
                            <textarea placeholder="Décrivez le projet en détail..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Image du Projet</label>
                            <div class="file-upload" onclick="document.getElementById('projectImage').click()">
                                <input type="file" id="projectImage" accept="image/*" required>
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><strong>Cliquez pour télécharger une image</strong></p>
                                <small>JPG, PNG acceptés (Max 5MB)</small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Créer le Projet
                        </button>
                    </form>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h2><i class="fas fa-tasks"></i> Projets en Cours</h2>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Projet</th>
                                <th>Objectif</th>
                                <th>Collecté</th>
                                <th>Progression</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Nouveau Studio</strong></td>
                                <td>20M FCFA</td>
                                <td>13M FCFA</td>
                                <td>
                                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: 65%; background: var(--success);"></div>
                                    </div>
                                    <small>65%</small>
                                </td>
                                <td><span class="badge badge-success">En Cours</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Équipement Diffusion</strong></td>
                                <td>10M FCFA</td>
                                <td>4.5M FCFA</td>
                                <td>
                                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: 45%; background: var(--warning);"></div>
                                    </div>
                                    <small>45%</small>
                                </td>
                                <td><span class="badge badge-warning">En Cours</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- TESTIMONIALS SECTION -->
            <section class="section" id="testimonials">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-plus"></i> Ajouter un Témoignage</h2>
                    </div>
                    
                    <form onsubmit="addTestimonial(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nom du Témoin</label>
                                <input type="text" placeholder="Ex: Marie Kouam" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Localisation</label>
                                <input type="text" placeholder="Ex: Bafoussam" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Témoignage</label>
                            <textarea placeholder="Partagez le témoignage inspirant..." required></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Publier le Témoignage
                        </button>
                    </form>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h2><i class="fas fa-comments"></i> Témoignages Publiés</h2>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Auteur</th>
                                <th>Localisation</th>
                                <th>Témoignage</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Marie Kouam</strong></td>
                                <td>Bafoussam</td>
                                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    Grâce à Radio Bonne Nouvelle, j'ai découvert Christ et ma vie a complètement changé...
                                </td>
                                <td>20/11/2024</td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Jean Tchatchoua</strong></td>
                                <td>Dschang</td>
                                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    Les émissions de prière matinale ont transformé ma vie spirituelle...
                                </td>
                                <td>18/11/2024</td>
                                <td>
                                    <button class="btn btn-secondary btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SETTINGS SECTION -->
            <section class="section" id="settings">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-cog"></i> Paramètres Généraux</h2>
                    </div>
                    
                    <form onsubmit="saveSettings(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nom de la Radio</label>
                                <input type="text" value="Radio Bonne Nouvelle" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Fréquence FM</label>
                                <input type="text" value="97.9 FM" required>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Adresse</label>
                                <input type="text" value="Bafoussam, Cameroun" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Téléphone</label>
                                <input type="tel" value="+237 123 456 789" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Email de Contact</label>
                            <input type="email" value="contact@radiobonnenouvelle.cm" required>
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea required>Propager l'Évangile à travers les ondes depuis 2005. Nous diffusons l'espoir, la foi et l'amour de Christ pour transformer des vies.</textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Enregistrer les Paramètres
                        </button>
                    </form>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h2><i class="fas fa-shield-alt"></i> Sécurité</h2>
                    </div>
                    
                    <form onsubmit="changePassword(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Mot de Passe Actuel</label>
                                <input type="password" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Nouveau Mot de Passe</label>
                                <input type="password" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Confirmer le Nouveau Mot de Passe</label>
                            <input type="password" required>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-key"></i> Changer le Mot de Passe
                        </button>
                    </form>
                </div>
            </section>
        </div>
    </main>

    <script>
        // NAVIGATION
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Tableau de Bord',
                'live': 'Gérer le Direct',
                'programs': 'Gérer les Émissions',
                'recordings': 'Enregistrements',
                'donations': 'Dons Reçus',
                'projects': 'Projets',
                'testimonials': 'Témoignages',
                'settings': 'Paramètres'
            };
            document.getElementById('pageTitle').textContent = titles[sectionId];
        }

        // SIDEBAR TOGGLE FOR MOBILE
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // LIVE STREAM FUNCTIONS
        function updateLiveStream() {
            const url = document.getElementById('liveUrl').value;
            const preview = document.getElementById('livePreview');
            
            if (!url) {
                alert('Veuillez entrer un lien Facebook Live');
                return;
            }
            
            preview.innerHTML = `
                <iframe src="https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=false&width=734" 
                        width="734" height="411" style="border:none;overflow:hidden" 
                        scrolling="no" frameborder="0" allowfullscreen="true" 
                        allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
                </iframe>`;
            
            alert('Direct mis à jour avec succès!');
        }

        function stopLiveStream() {
            document.getElementById('livePreview').innerHTML = `
                <div class="stream-placeholder">
                    <i class="fas fa-broadcast-tower"></i>
                    <h3>Aucun direct en cours</h3>
                    <p>Ajoutez un lien Facebook Live ci-dessus</p>
                </div>`;
            document.getElementById('liveUrl').value = '';
            alert('Direct arrêté avec succès!');
        }

        // FORM HANDLERS
        function addProgram(e) {
            e.preventDefault();
            alert('Émission ajoutée avec succès!');
            // Ici vous ajouteriez la logique pour sauvegarder en base de données
        }

        function uploadRecording(e) {
            e.preventDefault();
            alert('Enregistrement téléchargé avec succès!');
            // Ici vous ajouteriez la logique pour uploader le fichier
        }

        function addProject(e) {
            e.preventDefault();
            alert('Projet créé avec succès!');
            // Ici vous ajouteriez la logique pour sauvegarder en base de données
        }

        function addTestimonial(e) {
            e.preventDefault();
            alert('Témoignage publié avec succès!');
            // Ici vous ajouteriez la logique pour sauvegarder en base de données
        }

        function saveSettings(e) {
            e.preventDefault();
            alert('Paramètres sauvegardés avec succès!');
            // Ici vous ajouteriez la logique pour sauvegarder les paramètres
        }

        function changePassword(e) {
            e.preventDefault();
            alert('Mot de passe changé avec succès!');
            // Ici vous ajouteriez la logique pour changer le mot de passe
        }

        // FILE UPLOAD DISPLAY
        document.getElementById('recordingFile').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || 'Aucun fichier sélectionné';
            alert(`Fichier sélectionné: ${fileName}`);
        });

        document.getElementById('projectImage').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || 'Aucun fichier sélectionné';
            alert(`Image sélectionnée: ${fileName}`);
        });

// CONFIGURATION API
const API_BASE = '/.netlify/functions';

// FONCTIONS API
async function apiCall(endpoint, method = 'GET', data = null) {
  const options = {
    method,
    headers: {
      'Content-Type': 'application/json',
    },
  };
  
  if (data && method !== 'GET') {
    options.body = JSON.stringify(data);
  }
  
  try {
    const response = await fetch(`${API_BASE}/${endpoint}`, options);
    return await response.json();
  } catch (error) {
    console.error('API Error:', error);
    throw error;
  }
}

// GESTION PROGRAMMES
async function createProgram(programData) {
  return await apiCall('create-program', 'POST', programData);
}

async function updateLiveStatus(liveData) {
  return await apiCall('update-live', 'POST', liveData);
}

async function createDonation(donationData) {
  return await apiCall('create-donation', 'POST', donationData);
}

async function loadData(dataType) {
  return await apiCall(`get-data?type=${dataType}`);
}

// EXEMPLE: Mettre à jour le live
async function startLiveStream(facebookUrl) {
  const result = await updateLiveStatus({
    is_live: true,
    facebook_url: facebookUrl,
    title: 'Émission en Direct',
    description: 'Rejoignez-nous pour ce moment de partage'
  });
  
  if (result.success) {
    alert('Direct démarré avec succès!');
    // Mettre à jour l'interface
  }
}
// FONCTION MANQUANTE - AJOUTE ÇA
function displayPrograms(programs) {
  const container = document.getElementById('programsList');
  if (!container) {
    console.log('❌ Container programsList non trouvé');
    return;
  }
  
  console.log('📊 Affichage de', programs.length, 'programmes');
  
  if (programs.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; padding: 2rem; color: #666;">
        <i class="fas fa-microphone-slash" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <h3>Aucune émission publiée</h3>
        <p>Utilisez le formulaire ci-dessus pour créer votre première émission</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = `
    <table class="table">
      <thead>
        <tr>
          <th>Titre</th>
          <th>Animateur</th>
          <th>Durée</th>
          <th>Date</th>
          <th>Audio</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${programs.map(program => `
          <tr>
            <td><strong>${program.title}</strong></td>
            <td>${program.speaker}</td>
            <td>${program.duration}</td>
            <td>${program.date}</td>
            <td>
              <span class="badge ${program.audio_url.includes('default.mp3') ? 'badge-warning' : 'badge-success'}">
                ${program.audio_url.includes('default.mp3') ? 'Défaut' : 'GitHub'}
              </span>
            </td>
            <td>
              <button class="btn btn-secondary btn-sm" onclick="playProgram('${program.audio_url}')">
                <i class="fas fa-play"></i>
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteProgram('${program.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
}

// FONCTION POUR SUPPRIMER UN PROGRAMME
function deleteProgram(programId) {
  if (confirm('Êtes-vous sûr de vouloir supprimer cette émission ?')) {
    console.log('🗑️ Suppression programme:', programId);
    // À implémenter plus tard
    alert('Fonction suppression à implémenter');
  }
}
// EXEMPLE: Publier une émission
async function publishProgram() {
  const programData = {
    title: document.getElementById('programTitle').value,
    description: document.getElementById('programDescription').value,
    audio_url: document.getElementById('programAudioUrl').value, // Lien GitHub
    duration: document.getElementById('programDuration').value,
    speaker: document.getElementById('programSpeaker').value,
    category: document.getElementById('programCategory').value,
    image_url: document.getElementById('programImageUrl').value // Lien Cloudinary
  };
  
  const result = await createProgram(programData);
  if (result.success) {
    alert('Émission publiée avec succès!');
    // Reset form
  }
}

// CHARGER LES DONNÉES AU DEMARRAGE
document.addEventListener('DOMContentLoaded', async function() {
  // Charger les programmes
  const programs = await loadData('programs');
  displayPrograms(programs.programs);
  
  // Charger le statut live
  const liveStatus = await loadData('live');
  updateLiveDisplay(liveStatus);
});
        // GESTION UPLOAD AUDIO
document.getElementById('audioUploadArea').addEventListener('click', () => {
    document.getElementById('programAudioFile').click();
});

document.getElementById('programAudioFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        // Vérifier la taille (max 25MB)
        if (file.size > 25 * 1024 * 1024) {
            alert('Fichier trop volumineux. Maximum 25MB.');
            this.value = '';
            return;
        }

        // Afficher la preview
        document.getElementById('fileName').textContent = file.name;
        document.querySelector('.upload-placeholder').style.display = 'none';
        document.getElementById('audioPreview').style.display = 'flex';
    }
});

function clearAudioFile() {
    document.getElementById('programAudioFile').value = '';
    document.querySelector('.upload-placeholder').style.display = 'block';
    document.getElementById('audioPreview').style.display = 'none';
}

// SOUMISSION DU FORMULAIRE
// FONCTION DE DEBUG COMPLÈTE
document.getElementById('programForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publication...';
        submitBtn.disabled = true;

        console.log('🚀 Début processus...');

        // RÉCUPÉRER LE FICHIER
        const audioFile = document.getElementById('programAudioFile').files[0];
        
        if (!audioFile) {
            alert('❌ Veuillez sélectionner un fichier audio');
            return;
        }

        // VÉRIFIER LES CHAMPS OBLIGATOIRES
        const requiredFields = {
            title: document.getElementById('programTitle').value,
            description: document.getElementById('programDescription').value,
            duration: document.getElementById('programDuration').value,
            speaker: document.getElementById('programSpeaker').value,
            category: document.getElementById('programCategory').value
        };

        for (const [field, value] of Object.entries(requiredFields)) {
            if (!value) {
                alert(`❌ Le champ "${field}" est obligatoire`);
                return;
            }
        }

        console.log('✅ Tous les champs sont remplis');

        // CONVERTIR EN BASE64
        const audioData = await fileToBase64(audioFile);
        console.log('📦 Base64 généré');

        // PRÉPARER LES DONNÉES
        const programData = {
            title: requiredFields.title,
            description: requiredFields.description,
            duration: requiredFields.duration,
            speaker: requiredFields.speaker,
            category: requiredFields.category,
            image_url: document.getElementById('programImageUrl').value,
            audio_file: {
                name: audioFile.name.replace(/\s+/g, '-'), // Remplacer espaces
                data: audioData.split(',')[1]
            }
        };

        console.log('📤 Envoi des données...');
        
        // APPEL API
        const response = await fetch('/.netlify/functions/create-program', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(programData)
        });

        console.log('📡 Statut réponse:', response.status);

        let result;
        try {
            result = await response.json();
            console.log('📊 Réponse JSON:', result);
        } catch (jsonError) {
            console.error('❌ Erreur parsing JSON:', jsonError);
            throw new Error('Réponse serveur invalide');
        }

        if (result.success) {
            let message = '✅ Émission publiée avec succès!';
            if (result.audio_uploaded) {
                message += '\n🎵 Audio uploadé vers GitHub';
            } else {
                message += '\n⚠️ Audio non uploadé (utilisation défaut)';
            }
            
            alert(message);
            this.reset();
            clearFile('audio');
            clearFile('image');
            loadProgramsList();
        } else {
            throw new Error(result.error || result.details || 'Erreur inconnue');
        }

    } catch (error) {
        console.error('💥 Erreur:', error);
        alert('❌ Erreur: ' + error.message);
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
// FONCTION POUR VOIR LES LOGS EN TEMPS RÉEL
function enableDebugMode() {
    // Ouvrir la console automatiquement
    console.log('🔧 Mode debug activé');
    console.log('📋 Variables d\'environnement:');
    console.log('- URL:', window.location.origin);
    console.log('- Fonctions Netlify:', '/.netlify/functions/');
}

// Activer le debug au chargement
document.addEventListener('DOMContentLoaded', function() {
    enableDebugMode();
    loadProgramsList();
});

// CONVERSION FICHIER EN BASE64
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

// FONCTION API CREATE PROGRAM
async function createProgram(programData) {
    const response = await fetch('/.netlify/functions/create-program', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(programData)
    });
    return await response.json();
}
// Ajoute ce bouton de test dans ton dashboard
async function testAllFunctions() {
    console.log('🧪 Test complet des fonctions...');
    
    // Test 1: Fonction get-data
    try {
        const response1 = await fetch('/.netlify/functions/get-data?type=programs');
        console.log('✅ get-data status:', response1.status);
        const data1 = await response1.json();
        console.log('📊 get-data result:', data1);
    } catch (e) {
        console.error('❌ get-data failed:', e);
    }
    
    // Test 2: Fonction create-program (sans fichier)
    try {
        const testData = {
            title: "TEST - Émission de test",
            description: "Ceci est un test",
            duration: "1:00",
            speaker: "Testeur",
            category: "enseignement",
            audio_url: "https://example.com/test.mp3"
        };
        
        const response2 = await fetch('/.netlify/functions/create-program', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(testData)
        });
        console.log('✅ create-program status:', response2.status);
        const data2 = await response2.json();
        console.log('📊 create-program result:', data2);
    } catch (e) {
        console.error('❌ create-program failed:', e);
    }
}

// Appelle cette fonction depuis la console du navigateur
// CHARGER LA LISTE DES ÉMISSIONS
async function loadProgramsList() {
    try {
        const response = await fetch('/.netlify/functions/get-data?type=programs');
        const data = await response.json();
        displayProgramsTable(data.programs);
    } catch (error) {
        console.error('Error loading programs:', error);
    }
}

// AFFICHER LE TABLEAU DES ÉMISSIONS
function displayProgramsTable(programs) {
    const container = document.getElementById('programsList');
    if (!container) return;

    container.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>Titre</th>
                    <th>Animateur</th>
                    <th>Durée</th>
                    <th>Date</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                ${programs.map(program => `
                    <tr>
                        <td><strong>${program.title}</strong></td>
                        <td>${program.speaker}</td>
                        <td>${program.duration}</td>
                        <td>${program.date}</td>
                        <td>
                            <span class="badge ${program.published ? 'badge-success' : 'badge-warning'}">
                                ${program.published ? 'Publié' : 'Brouillon'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary btn-sm" onclick="playProgram('${program.audio_url}')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProgram('${program.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

// JOUER UNE ÉMISSION
function playProgram(audioUrl) {
    const audio = new Audio(audioUrl);
    audio.play().catch(e => {
        alert('Impossible de lire l\'audio. Vérifiez le lien GitHub.');
    });
}
    </script>
</body>
</html>
